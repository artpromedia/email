# ============================================================
# ENTERPRISE EMAIL SYSTEM - ENVIRONMENT CONFIGURATION
# ============================================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control
# ============================================================

# ============================================================
# APPLICATION SETTINGS
# ============================================================
NODE_ENV=production
LOG_LEVEL=info
APP_NAME=Enterprise Email
APP_VERSION=1.0.0

# ============================================================
# MULTI-DOMAIN CONFIGURATION
# ============================================================
# Primary domain for the email system
PRIMARY_DOMAIN=example.com

# Comma-separated list of all allowed domains
# Each domain requires proper DNS, MX, SPF, DKIM, and DMARC records
ALLOWED_DOMAINS=example.com,example.org,subsidiary.com

# Default domain for new users/tenants
DEFAULT_DOMAIN=example.com

# Domain verification settings
# Used to verify domain ownership via DNS TXT record
DOMAIN_VERIFICATION_PREFIX=_enterprise-email-verify
DOMAIN_VERIFICATION_TTL=3600

# Maximum domains per organization (0 = unlimited)
MAX_DOMAINS_PER_ORG=10

# ============================================================
# DKIM CONFIGURATION (Per-Domain)
# ============================================================
# DKIM selector (used in DNS: selector._domainkey.domain.com)
DKIM_SELECTOR=mail

# Path to DKIM private keys directory
# Structure: /etc/dkim/keys/{domain}/private.key
DKIM_KEYS_PATH=/etc/dkim/keys

# DKIM key size (2048 recommended)
DKIM_KEY_SIZE=2048

# DKIM signing algorithm
DKIM_ALGORITHM=rsa-sha256

# DKIM canonicalization
DKIM_CANONICALIZATION=relaxed/relaxed

# ============================================================
# DATABASE CONFIGURATION
# ============================================================
# PostgreSQL connection
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=email_admin
POSTGRES_PASSWORD=email_secure_password_123
POSTGRES_DB=enterprise_email

# Full connection URL (computed)
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?schema=public

# Connection pool settings
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10
DATABASE_TIMEOUT=30000

# ============================================================
# REDIS CONFIGURATION
# ============================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=redis_secure_password_123
REDIS_DB=0

# Full Redis URL
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}

# Redis key prefix (for multi-tenant isolation)
REDIS_KEY_PREFIX=email:

# Session settings
SESSION_TTL=86400
CACHE_TTL=3600

# ============================================================
# MINIO / S3 CONFIGURATION
# ============================================================
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_USE_SSL=false
MINIO_ROOT_USER=minio_admin
MINIO_ROOT_PASSWORD=minio_secure_password_123

# S3-compatible access (for SDK)
S3_ACCESS_KEY=${MINIO_ROOT_USER}
S3_SECRET_KEY=${MINIO_ROOT_PASSWORD}
S3_ENDPOINT=http://${MINIO_ENDPOINT}:${MINIO_PORT}
S3_REGION=us-east-1
S3_FORCE_PATH_STYLE=true

# Bucket names
S3_BUCKET_ATTACHMENTS=attachments
S3_BUCKET_TEMPLATES=templates
S3_BUCKET_EXPORTS=exports
S3_BUCKET_BACKUPS=backups

# Attachment settings
MAX_ATTACHMENT_SIZE=26214400
ALLOWED_ATTACHMENT_TYPES=pdf,doc,docx,xls,xlsx,ppt,pptx,txt,csv,jpg,jpeg,png,gif,zip

# ============================================================
# OPENSEARCH CONFIGURATION
# ============================================================
OPENSEARCH_HOST=localhost
OPENSEARCH_PORT=9200
OPENSEARCH_PROTOCOL=http
OPENSEARCH_PASSWORD=OpenSearch_Secure_123!

# Full OpenSearch URL
OPENSEARCH_URL=${OPENSEARCH_PROTOCOL}://${OPENSEARCH_HOST}:${OPENSEARCH_PORT}

# Index settings
OPENSEARCH_INDEX_PREFIX=email_
OPENSEARCH_INDEX_EMAILS=emails
OPENSEARCH_INDEX_CONTACTS=contacts
OPENSEARCH_INDEX_AUDIT=audit

# Search settings
SEARCH_MAX_RESULTS=1000
SEARCH_HIGHLIGHT_FRAGMENT_SIZE=150

# ============================================================
# EMAIL SMTP CONFIGURATION
# ============================================================
# Development SMTP (Mailpit)
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_SECURE=false
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM_NAME=Enterprise Email
SMTP_FROM_ADDRESS=noreply@${PRIMARY_DOMAIN}

# SMTP connection pool
SMTP_POOL_SIZE=5
SMTP_POOL_MAX_CONNECTIONS=10

# Rate limiting (per domain)
SMTP_RATE_LIMIT_PER_MINUTE=100
SMTP_RATE_LIMIT_PER_HOUR=2000
SMTP_RATE_LIMIT_PER_DAY=10000

# ============================================================
# EMAIL RECEIVING (IMAP/POP3)
# ============================================================
IMAP_HOST=localhost
IMAP_PORT=993
IMAP_SECURE=true

POP3_HOST=localhost
POP3_PORT=995
POP3_SECURE=true

# ============================================================
# AUTHENTICATION & SECURITY
# ============================================================
# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-change-in-production-min-32-chars
JWT_ISSUER=enterprise-email
JWT_AUDIENCE=enterprise-email-clients
JWT_ACCESS_TOKEN_EXPIRES=15m
JWT_REFRESH_TOKEN_EXPIRES=7d

# Session Configuration
SESSION_SECRET=your-session-secret-change-in-production-min-32-chars
SESSION_NAME=email_session
SESSION_SECURE=false
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=lax

# Password Policy
PASSWORD_MIN_LENGTH=12
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SYMBOLS=true
PASSWORD_MAX_AGE_DAYS=90

# Rate Limiting
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100
LOGIN_MAX_ATTEMPTS=5
LOGIN_LOCKOUT_MINUTES=15

# CORS Configuration
CORS_ORIGINS=http://localhost:3000,http://localhost:3001
CORS_CREDENTIALS=true

# ============================================================
# API CONFIGURATION
# ============================================================
API_HOST=0.0.0.0
API_PORT=4000
API_PREFIX=/api/v1

# GraphQL
GRAPHQL_PLAYGROUND=false
GRAPHQL_INTROSPECTION=false
GRAPHQL_DEBUG=false

# ============================================================
# WEB APPLICATION URLS
# ============================================================
WEB_APP_URL=http://localhost:3000
ADMIN_APP_URL=http://localhost:3001
API_URL=http://localhost:4000

# ============================================================
# DNS CONFIGURATION (Development)
# ============================================================
DNS_SERVER=localhost
DNS_PORT=5353

# ============================================================
# MONITORING & OBSERVABILITY
# ============================================================
# OpenTelemetry
OTEL_ENABLED=false
OTEL_SERVICE_NAME=enterprise-email
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318

# Sentry
SENTRY_DSN=
SENTRY_ENVIRONMENT=${NODE_ENV}
SENTRY_TRACES_SAMPLE_RATE=0.1

# ============================================================
# FEATURE FLAGS
# ============================================================
FEATURE_MULTI_DOMAIN=true
FEATURE_CUSTOM_DOMAINS=true
FEATURE_EMAIL_TEMPLATES=true
FEATURE_EMAIL_SCHEDULING=true
FEATURE_EMAIL_TRACKING=true
FEATURE_SPAM_FILTERING=true
FEATURE_VIRUS_SCANNING=false
FEATURE_2FA=true
FEATURE_SSO=false
FEATURE_API_ACCESS=true
FEATURE_WEBHOOKS=true

# ============================================================
# QUEUE CONFIGURATION (BullMQ)
# ============================================================
QUEUE_PREFIX=email:queue:
QUEUE_EMAIL_SEND=email-send
QUEUE_EMAIL_RECEIVE=email-receive
QUEUE_EMAIL_PROCESS=email-process
QUEUE_DOMAIN_VERIFY=domain-verify
QUEUE_CLEANUP=cleanup

# Queue job settings
QUEUE_JOB_ATTEMPTS=3
QUEUE_JOB_BACKOFF_TYPE=exponential
QUEUE_JOB_BACKOFF_DELAY=1000

# ============================================================
# ADMIN PORTS (Development UIs)
# ============================================================
MAILPIT_HTTP_PORT=8025
MINIO_CONSOLE_PORT=9001
ADMINER_PORT=8080
REDIS_COMMANDER_PORT=8081
OPENSEARCH_DASHBOARDS_PORT=5601
